<table
  *ngIf="{
    grid: grid$ | async,
    horizontalHeader: horizontalHeader$ | async,
    verticalHeader: verticalHeader$ | async,
    editableId: editableId$ | async,
    values: values$ | async
  } as context"
>
  <tbody>
    <tr>
      <th></th>
      <th *ngFor="let headerCell of context.horizontalHeader">
        {{ headerCell }}
      </th>
    </tr>
    <tr *ngFor="let row of context.grid; let rowIndex = index">
      <th>{{context.verticalHeader?.[rowIndex]}}</th>
      <td *ngFor="let id of row" (click)="setEditableId(id, inputElement)">
        <div
          *ngIf="id !== context.editableId"
        >
          {{context.values?.[id]?.value}}
        </div>
        <input
          [value]="context.values?.[id]?.formula ?? ''"
          [class.display-none]="id !== context.editableId"
          (change)="applyFormula(inputElement.value, id)"
          #inputElement
          type="text"
          (blur)="clearEditableId()"
        />
      </td>
    </tr>
  </tbody>
</table>
